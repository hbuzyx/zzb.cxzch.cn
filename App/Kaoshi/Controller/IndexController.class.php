<?phpnamespace Kaoshi\Controller;class IndexController extends MobileCommonController{    //方法：index    public function index()    {//        $a = ['A'=>'dayu','B'=>'xiaoyu'];//        $b = json_encode($a);//        var_dump($b);        //单选题        $num = M('ti')->where(array('type' => 1,'status' => 1))->count();        $all = M('ti')->where(array('type' => 1,'status' => 1))->select();        foreach ($all as $key =>$item){            $all[$key]['item'] =  json_decode($item['item'],true);        }//        var_dump($all);die;        $this->assign('ti', $all);        $this->assign('num', $num);        $this->assign('title', C('CFG_WEBNAME'));        //插入或不操作考试统计表        $data = [            'user_id'=>1,            'answer'=>'',            'all_num'=>0,            'yes_num'=>0,            'score'=>0,            'elapsed'=>0,            'status'=>0,            'create_time'=>date('Y-m-d H:i:s',time()),            ];        $kaoshi = M('ti_kaoshi')->where(array('user_id' => 1,'status' => 0))->order('create_time desc')->find();        if(empty($kaoshi)){            M('ti_kaoshi')->add($data);        }        $this->display();    }    public function saveUserAnswer()    {        $data = I('post.');        $kaoshi = M('ti_kaoshi')->where(array('user_id' => 1,'status' => 0))->order('create_time desc')->find();        if(empty($kaoshi)){            //            $this->ajaxReturn(['status'=>0,'msg'=>'不能重复交卷，如有疑问请联系管理员']);        }else{            //写入日志表            $data3 = [                'user_id'=>1,                'answer'=>json_encode($data['question'],true),                'score'=>$data['insertscore'],                'kaoshi_id'=>$kaoshi['id'],                'create_time'=>date('Y-m-d H:i:s',time()),            ];            M('ti_log')->add($data3);            //更新考试统计表            $keys = array_keys($data['question']);            if($keys){                $where['id'] = array('in',$keys);            }else{                $where = '1=1';            }            $res = M('ti')->where($where)->field('id,anwser')->select();            $anwser_new =[];            foreach ($res as $key=>$vo){                $anwser_new[$vo['id']] = $vo['anwser'];            }            $yes_ti = array_intersect_assoc($data['question'],$anwser_new);            $yes_num = count($yes_ti);            $data2 = [                'user_id'=>1,                'answer'=>json_encode($data['question']),                'all_num'=>count($data['question']),                'yes_num'=>$yes_num,                'score'=>$yes_num*10,                'elapsed'=>time()-strtotime($kaoshi['create_time']),                'status'=>1,                'end_time'=>date('Y-m-d H:i:s',time()),            ];            $yes2 = M('ti_kaoshi')->where(array('user_id' => 1,'status' => 0))->save($data2);        }        if($yes2){            $this->ajaxReturn(['status'=>1,'msg'=>'交卷成功']);        }else{            $this->ajaxReturn(['status'=>0,'msg'=>'交卷失败']);        }    }    public function result()    {        $kaoshi = M('ti_kaoshi')->where(array('user_id' => 1,'status' => 1))->order('create_time desc')->find();        $kaoshi['elapsed'] = $this->ftime($kaoshi['elapsed']);        $this->assign('title', C('CFG_WEBNAME'));        $this->assign('kaoshi', $kaoshi);        $this->display();    }    public function exampaper()    {        $data = I('post.');        var_dump($data);    }    public function answer()    {        $this->assign('title', C('CFG_WEBNAME'));        $this->display();    }    public function ftime($s)    {        $s = gmdate('H:i:s', $s);        $time = explode(':', $s);        $time['0'] == '00' ? $h = 0 : $h = $time['0'];        $time['1'] == '00' ? $m = 0 : $m = $time['1'];        $time['2'] == '00' ? $s = 0 : $s = $time['2'];        $ftime = (        empty($h) ? (        empty($m) ? $s .'秒' : (        empty($s) ? $m . '分' : $m . '分' . $s .'秒'        )        ) :(        empty($m) && empty($s) ? $h .'小时' : (        empty($m)  ? $h . '时' . $s . '秒' : (        empty($s) ? $h . '小时' . $m . '分' : $h . '小时' . $m . '分' .$s . '秒'        )        )        )        );        return $ftime;    }}