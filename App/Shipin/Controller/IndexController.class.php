<?phpnamespace Shipin\Controller;class IndexController extends MobileCommonController{    //远程远教首页    public function index()    {        $proModel = M('category');        $ids = $proModel->where(array('pid' => 58))->Field('id,name')->select();        $this->assign('ids', $ids);//        $datas = M('category')//            ->join('my_soft soft on my_category.id=soft.cid')//            ->field("my_category.id cat_id,soft.id,soft.title,soft.litpic,soft.downlink,soft.description")//需要显示的字段//            ->where(array('my_category.pid' => 58))//            ->select();        $count      = $proModel->join('my_soft soft on my_category.id=soft.cid')->where(array('my_category.pid' => 58))->count();// 查询满足要求的总记录数        $Page       = new \Think\Page($count,8);// 实例化分页类 传入总记录数和每页显示的记录数(25)        $show       = $Page->show();// 分页显示输出// 进行分页数据查询 注意limit方法的参数要使用Page类的属性        $datas = $proModel            ->join('my_soft soft on my_category.id=soft.cid')            ->field("my_category.id cat_id,soft.id,soft.title,soft.litpic,soft.downlink,soft.description")//需要显示的字段            ->where(array('my_category.pid' => 58))            ->order('soft.publishtime desc')            ->limit($Page->firstRow.','.$Page->listRows)            ->select();        $this->assign('page',$show);// 赋值分页输出        $this->assign('lists', $datas);        $this->display();    }    public function login()    {        $username = I('username', '', 'htmlspecialchars,trim');        $password = md5(I('password', '', 'htmlspecialchars,trim'));        $info = M('member')->where(array('username' => $username))->find();        if($info){            if($info['password'] == $password){                session('id',$info['id']);                session('name',$info['username']);                session('IsLogin',1);                $this->ajaxReturn(['status'=>1,'msg'=>'登陆成功'],JSON);            }else{                $this->ajaxReturn(['status'=>0,'msg'=>'密码错误'],JSON);            }        }else{            $this->ajaxReturn(['status'=>0,'msg'=>'用户名不存在'],JSON);        }    }    public function logout()    {//        session(null);        session('id',null);        session('name',null);        session('IsLogin',null);        $this->ajaxReturn(['status'=>1,'msg'=>'退出登陆成功'],JSON);    }    public function zhuce()    {        $data['username'] = I('username', '', 'htmlspecialchars,trim');        $data['password'] = md5(I('password', '', 'htmlspecialchars,trim'));        $data['email'] = I('name', '', 'htmlspecialchars,trim');        $info = M('member')->where(array('username' => $data['username']))->find();        if(empty($info)){            $data['regtime'] = time();            if ($id = M('member')->add($data)) {                session('id',M()->getLastInsID());                session('name',$data['username']);                session('IsLogin',1);                $this->ajaxReturn(['status' => 1, 'msg' => '注册成功'], JSON);            }else{                $this->ajaxReturn(['status'=>0,'msg'=>'注册失败'],JSON);            }        }else{            $this->ajaxReturn(['status'=>0,'msg'=>'手机号已存在'],JSON);        }    }}