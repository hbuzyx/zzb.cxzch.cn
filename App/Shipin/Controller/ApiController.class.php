<?phpnamespace Shipin\Controller;class ApiController extends MobileCommonController{    protected function _initialize()    {        parent::_initialize();        $sid = session('id');//检测session是否存bai在，不存在就跳du登录页面        if(!isset($sid)){            $this->error('请登录！',U('Shipin/index/index'),1);        }    }    public function detail()    {        $id = I('get.id');        $info = M('soft')->where(array('id' => $id))->find();        //        $info['downlink']='http://'.$_SERVER['HTTP_HOST'].substr($info['downlink'],0,strlen($info['downlink'])-3);str_replace("world","Shanghai","Hello world!");        $info['downlink']='http://'.$_SERVER['HTTP_HOST'].str_replace('|','',$info['downlink']);        $this->assign('info', $info);        $this->assign('title', C('CFG_WEBNAME'));        $this->display('video-detail');    }    public function shichang()    {        $user_id = I('user_id');        $video_id = I('video_id');        $shichang = I('shichang');        $info = M('video_log')->where(array('user_id' => $user_id,'video_id' => $video_id))->order('create_time desc')->find();        if(substr($info['create_time'],0,10)==date('Y-m-d')){            $yes = M('video_log')->where(array('id' => $info['id']))->setField('shichang',$shichang);        }else{            $yes = M('video_log')->where(array('user_id' => $user_id,'video_id' => $video_id))->add(array('user_id' => $user_id,'video_id' => $video_id,'shichang'=>$shichang,'create_time'=>date('Y-m-d H:i:s',time())));        }        if ($yes!==false) {            $this->ajaxReturn(['status' => 1, 'msg' => '记录成功'], JSON);        }else{            $this->ajaxReturn(['status'=>0,'msg'=>'记录失败'],JSON);        }    }    public function shijiandian()    {        $user_id = I('user_id');        $video_id = I('video_id');        $info = M('video_log')->where(array('user_id' => $user_id,'video_id' => $video_id))->field('shichang')->find();        if ($info) {            $this->ajaxReturn(['status' => 1, 'msg' => '查询成功',"data"=>$info['shichang']], JSON);        }else{            $this->ajaxReturn(['status'=>0,'msg'=>'查询失败',"data"=>0],JSON);        }    }    public function shijiandian2()    {        $user_id = I('user_id');        $shichang = I('shichang');        $info = M('member')->where(array('id' => $user_id))->setInc('shichang',$shichang/1000);        if ($info) {            $this->ajaxReturn(['status' => 1, 'msg' => '记录成功',"data"=>$info['shichang']], JSON);        }else{            $this->ajaxReturn(['status'=>0,'msg'=>'记录失败',"data"=>0],JSON);        }    }}